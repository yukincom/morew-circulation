<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒèŠ’æ˜Ÿé˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a4d 0%, #2d2d6b 100%);
            font-family: 'Courier New', monospace;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .ainu-pattern {
            width: 80px;
            height: 80px;
        }

        h1 {
            font-size: 2.5em;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #b8b8ff;
            margin-top: 10px;
        }

        .heptagram-container {
            position: relative;
            width: 550px;
            height: 550px;
            margin: 0 auto 40px;
        }

        #heptagram {
            width: 100%;
            height: 100%;
        }

        .double-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 2px solid white;
        }

        .outer-circle {
            width: 420px;
            height: 420px;
            opacity: 0.6;
        }

        .inner-circle {
            width: 400px;
            height: 400px;
            opacity: 0.6;
        }

        .center-shield {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            opacity: 0.8;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .vertex-label {
            position: absolute;
            background: rgba(26, 26, 77, 0.9);
            border: 2px solid #ffffff;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.85em;
            color: #ffffff;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
        }

        .vertex-label:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .vertex-label.active {
            background: rgba(220, 20, 60, 0.8);
            border-color: #ff4444;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(220, 20, 60, 0.5);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(220, 20, 60, 0.8);
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        .center-status {
            display: none;
        }

        .status-bar {
            text-align: center;
            margin: 20px auto 30px;
            max-width: 900px;
        }

        .status-bar-title {
            font-size: 1.2em;
            color: #b8b8ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .status-bar-title::before,
        .status-bar-title::after {
            content: 'â–³';
            font-size: 1.5em;
        }

        .active-modules {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .active-modules::before,
        .active-modules::after {
            content: 'â–³';
            font-size: 2em;
            color: #ffffff;
        }

        .module-card {
            background: rgba(26, 26, 77, 0.8);
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 12px 20px;
            color: #ffffff;
            font-size: 1em;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .module-card.alert {
            background: rgba(220, 20, 60, 0.8);
            border-color: #ff4444;
            animation: alertPulse 1s ease-in-out infinite;
        }

        .status-card {
            background: rgba(26, 26, 77, 0.8);
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 15px 30px;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .status-card.alert {
            background: rgba(220, 20, 60, 0.8);
            border-color: #ff4444;
            animation: alertPulse 1s ease-in-out infinite;
        }

        .status-card-icon {
            font-size: 1.5em;
        }

        .status-card-text {
            font-size: 1.2em;
            font-weight: bold;
            color: #ffffff;
        }

        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(220, 20, 60, 0.5); }
            50% { box-shadow: 0 0 40px rgba(220, 20, 60, 1); }
        }



        .control-panel {
            background: rgba(26, 26, 77, 0.8);
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .key-upload-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .upload-area {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            background: #4a4a8a;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #ffffff;
        }

        .file-label:hover {
            background: #6a6aaa;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        button {
            background: #2d5a8a;
            color: white;
            padding: 12px 24px;
            border: 2px solid #ffffff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        button:hover {
            background: #3d7aba;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .key-status {
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }

        .key-status.unverified {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }

        .key-status.verified {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }

        .key-status.failed {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .tactical-view {
            background: rgba(26, 26, 77, 0.8);
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            display: none;
        }

        .tactical-view.visible {
            display: block;
        }

        .tactical-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffffff;
        }

        .tactical-header h2 {
            font-size: 1.5em;
            color: #ffffff;
        }

        .close-btn {
            background: #8a2d2d;
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .close-btn:hover {
            background: #aa3d3d;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #4a4a8a;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .log-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            margin-right: 10px;
            font-weight: bold;
            font-size: 0.85em;
        }

        .log-type.read {
            background: #2196F3;
            color: white;
        }

        .log-type.exec {
            background: #FF9800;
            color: white;
        }

        .log-type.error {
            background: #f44336;
            color: white;
        }

        .log-type.recursion {
            background: #9C27B0;
            color: white;
        }

        .log-message {
            color: #ffffff;
        }

        .toggle-tactical-btn {
            margin-top: 20px;
            background: #4a4a8a;
            width: 100%;
        }

        .toggle-tactical-btn:hover {
            background: #6a6aaa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4a4a8a;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #b8b8ff;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .log-container::-webkit-scrollbar {
            width: 8px;
        }

        .log-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .log-container::-webkit-scrollbar-thumb {
            background: #4a4a8a;
            border-radius: 4px;
        }

        .log-container::-webkit-scrollbar-thumb:hover {
            background: #6a6aaa;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title-container">
            <!-- å·¦å´ã®ã‚¢ã‚¤ãƒŒæ¨¡æ§˜ -->
            <svg class="ainu-pattern" viewBox="0 0 100 100">
                <path d="M 10,50 Q 25,30 40,50 T 70,50 T 90,50" 
                      stroke="white" fill="none" stroke-width="2"/>
                <path d="M 20,40 Q 30,25 40,40" 
                      stroke="white" fill="none" stroke-width="1.5"/>
                <path d="M 60,40 Q 70,25 80,40" 
                      stroke="white" fill="none" stroke-width="1.5"/>
                <circle cx="50" cy="50" r="15" stroke="white" fill="none" stroke-width="2"/>
                <path d="M 35,60 Q 50,75 65,60" 
                      stroke="white" fill="none" stroke-width="2"/>
            </svg>

            <h1>ä¸ƒèŠ’æ˜Ÿé˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ </h1>

            <!-- å³å´ã®ã‚¢ã‚¤ãƒŒæ¨¡æ§˜ -->
            <svg class="ainu-pattern" viewBox="0 0 100 100">
                <path d="M 10,50 Q 25,30 40,50 T 70,50 T 90,50" 
                      stroke="white" fill="none" stroke-width="2"/>
                <path d="M 20,40 Q 30,25 40,40" 
                      stroke="white" fill="none" stroke-width="1.5"/>
                <path d="M 60,40 Q 70,25 80,40" 
                      stroke="white" fill="none" stroke-width="1.5"/>
                <circle cx="50" cy="50" r="15" stroke="white" fill="none" stroke-width="2"/>
                <path d="M 35,60 Q 50,75 65,60" 
                      stroke="white" fill="none" stroke-width="2"/>
            </svg>
        </div>
        <div class="subtitle">Heptagram Defense System - æ±ºå®šä¸èƒ½ãªæ§‹é€ ã«ã‚ˆã‚‹é˜²å¾¡</div>
    </div>

    <div class="heptagram-container">
        <!-- äºŒé‡ã®å†† -->
        <div class="double-circle outer-circle"></div>
        <div class="double-circle inner-circle"></div>
        
        <svg id="heptagram" viewBox="0 0 550 550">
            <!-- ä¸ƒèŠ’æ˜Ÿã®æç”» -->
            <g id="star-lines"></g>
        </svg>
        
        <!-- å„é ‚ç‚¹ã®ãƒ©ãƒ™ãƒ« -->
        <div class="vertex-label" id="vertex-0">auth_legacy.py</div>
        <div class="vertex-label" id="vertex-1">db_credentials.py</div>
        <div class="vertex-label" id="vertex-2">admin_recovery.py</div>
        <div class="vertex-label" id="vertex-3">session_manager.py</div>
        <div class="vertex-label" id="vertex-4">backup_keys.py</div>
        <div class="vertex-label" id="vertex-5">crypto_utils.py</div>
        <div class="vertex-label" id="vertex-6">token_validator.py</div>

        <!-- ä¸­å¤®ã®ç›¾ -->
        <div class="center-shield">ğŸ›¡ï¸</div>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆæ¨ªä¸¦ã³ï¼‰ -->
    <div class="status-bar">
        <div class="status-bar-title">å¾…æ©Ÿä¸­ã‚³ãƒ¼ãƒ‰</div>
        <div class="active-modules" id="activeModules">
            <div class="module-card">config_parser.py</div>
            <div class="module-card">user_privileges.py</div>
            <div class="module-card">api_gateway.py</div>
        </div>
        <div class="status-card" id="statusCard">
            <div class="status-card-icon">â¸ï¸</div>
            <div class="status-card-text">ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­</div>
        </div>
    </div>

    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="control-panel">
        <div class="key-upload-section">
            <h3>ğŸ”‘ ç‰©ç†ã‚­ãƒ¼æ¤œè¨¼</h3>
            <div class="upload-area">
                <label for="keyFileInput" class="file-label">
                    ğŸ“ ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                </label>
                <input type="file" id="keyFileInput" accept=".json,.py">
                <button id="verifyKeyBtn" disabled>æ¤œè¨¼é–‹å§‹</button>
            </div>
            <div id="keyStatus" class="key-status unverified">
                æœªæ¤œè¨¼ - ç‰©ç†ã‚­ãƒ¼ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„
            </div>
        </div>
        <button class="toggle-tactical-btn" id="toggleTacticalBtn">
            ğŸ“Š æ”»æ’ƒè€…è¦–ç‚¹ã‚’è¡¨ç¤º
        </button>
    </div>

    <!-- æˆ¦è¡“ç”»é¢ -->
    <div class="tactical-view" id="tacticalView">
        <div class="tactical-header">
            <h2>ğŸ¯ æ”»æ’ƒè€…æˆ¦è¡“ç”»é¢ï¼ˆComputer Use ãƒ­ã‚°ï¼‰</h2>
            <button class="close-btn" id="closeTacticalBtn">é–‰ã˜ã‚‹</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="statFileAccess">0</div>
                <div class="stat-label">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statExecution">0</div>
                <div class="stat-label">å®Ÿè¡Œè©¦è¡Œ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statErrors">0</div>
                <div class="stat-label">ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statElapsed">0s</div>
                <div class="stat-label">çµŒéæ™‚é–“</div>
            </div>
        </div>

        <div class="log-container" id="logContainer">
            <div class="log-entry">
                <span class="log-timestamp">[00:00:00]</span>
                <span class="log-message">ã‚·ã‚¹ãƒ†ãƒ èµ·å‹• - ç›£è¦–é–‹å§‹</span>
            </div>
        </div>
    </div>

    <script>
function updateWaitingModules() {
    const container = document.getElementById('activeModules');
    if (!container) return;

    container.innerHTML = '';

    (systemState.waitingModules || []).forEach(moduleName => {
        const card = document.createElement('div');
        card.className = 'module-card';
        card.textContent = moduleName;
        container.appendChild(card);
    });
}

function shuffleWaitingModules() {
    if (systemState.keyVerified) return;

    const shuffled = [...systemState.allModules].sort(() => Math.random() - 0.5);
    systemState.waitingModules = shuffled.slice(0, 3);
    updateWaitingModules();
}

        // ä¸ƒèŠ’æ˜Ÿã®æç”»
        function drawHeptagram() {
            const svg = document.getElementById('star-lines');
            const centerX = 275;
            const centerY = 275;
            const radius = 200;
            const points = 7;
            
            // é ‚ç‚¹ã®åº§æ¨™ã‚’è¨ˆç®—
            const vertices = [];
            for (let i = 0; i < points; i++) {
                const angle = (Math.PI * 2 * i / points) - Math.PI / 2;
                vertices.push({
                    x: centerX + radius * Math.cos(angle),
                    y: centerY + radius * Math.sin(angle)
                });
            }
            
            // Acute heptagram (7/3 star polygon) ã‚’æç”»
            // å„é ‚ç‚¹ã‹ã‚‰3ã¤å…ˆã®é ‚ç‚¹ã«ç·šã‚’å¼•ã
            let pathData = `M ${vertices[0].x} ${vertices[0].y}`;
            for (let i = 0; i < points; i++) {
                const nextIndex = (i * 3) % points;
                pathData += ` L ${vertices[nextIndex].x} ${vertices[nextIndex].y}`;
            }
            pathData += ' Z';
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', 'white');
            path.setAttribute('stroke-width', '3');
            path.setAttribute('fill', 'none');
            path.setAttribute('opacity', '0.8');
            svg.appendChild(path);
            
            // é ‚ç‚¹ãƒ©ãƒ™ãƒ«ã®é…ç½®
            vertices.forEach((vertex, index) => {
                const label = document.getElementById(`vertex-${index}`);
                label.style.left = `${vertex.x}px`;
                label.style.top = `${vertex.y}px`;
            });
        }

        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
        let systemState = {
            keyVerified: false,
            intrusionDetected: false,
            startTime: null,
            currentVertex: null,
            stats: {
                fileAccess: 0,
                execution: 0,
                errors: 0
            },
            allModules: [
                'auth_legacy.py',
                'db_credentials.py',
                'admin_recovery.py',
                'session_manager.py',
                'backup_keys.py',
                'crypto_utils.py',
                'token_validator.py',
                'config_parser.py',
                'user_privileges.py',
                'api_gateway.py'
            ],
            waitingModules: ['config_parser.py', 'user_privileges.py', 'api_gateway.py']
        };

        // ãƒ­ã‚°è¿½åŠ é–¢æ•°
        function addLog(type, message) {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const now = systemState.startTime ? 
                Math.floor((Date.now() - systemState.startTime) / 1000) : 0;
            const timestamp = `${String(Math.floor(now / 60)).padStart(2, '0')}:${String(now % 60).padStart(2, '0')}`;
            
            entry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-type ${type}">${type.toUpperCase()}</span>
                <span class="log-message">${message}</span>
            `;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // é ‚ç‚¹ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
        function activateVertex(index) {
            // å‰ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚’è§£é™¤
            document.querySelectorAll('.vertex-label').forEach(el => {
                el.classList.remove('active');
            });
            
            // æ–°ã—ã„ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚’è¨­å®š
            const vertex = document.getElementById(`vertex-${index}`);
            vertex.classList.add('active');
            systemState.currentVertex = index;
            
            // ãƒ­ã‚°è¿½åŠ 
            const filename = vertex.textContent;
            addLog('read', `ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿: ${filename}`);
            systemState.stats.fileAccess++;
            updateStats();
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            document.getElementById('statFileAccess').textContent = systemState.stats.fileAccess;
            document.getElementById('statExecution').textContent = systemState.stats.execution;
            document.getElementById('statErrors').textContent = systemState.stats.errors;
            
            if (systemState.startTime) {
                const elapsed = Math.floor((Date.now() - systemState.startTime) / 1000);
                document.getElementById('statElapsed').textContent = `${elapsed}s`;
            }
        }

        // ä¾µå…¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateIntrusion() {
            if (systemState.keyVerified) return;
            
            const actions = [
                { type: 'read', msg: 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆè©¦è¡Œ', vertex: true },
                { type: 'exec', msg: 'validate_password() å®Ÿè¡Œ', vertex: false },
                { type: 'error', msg: 'ImportError: circular import detected', vertex: false },
                { type: 'read', msg: 'db_credentials.py ã«ã‚¢ã‚¯ã‚»ã‚¹', vertex: true },
                { type: 'exec', msg: 'get_master_password() å®Ÿè¡Œ', vertex: false },
                { type: 'recursion', msg: 'RecursionError: maximum recursion depth exceeded', vertex: false },
                { type: 'read', msg: 'backup_keys.py ã‚’æ¢ç´¢', vertex: true },
                { type: 'error', msg: 'AttributeError: module has no attribute "verify_key"', vertex: false },
                { type: 'exec', msg: 'ãƒªãƒˆãƒ©ã‚¤å‡¦ç†é–‹å§‹...', vertex: false }
            ];
            
            let actionIndex = 0;
            
            const interval = setInterval(() => {
                if (systemState.keyVerified) {
                    clearInterval(interval);
                    return;
                }
                
                const action = actions[actionIndex % actions.length];
                addLog(action.type, action.msg);
                
                if (action.vertex) {
                    const randomVertex = Math.floor(Math.random() * 7);
                    activateVertex(randomVertex);
                }
                
                if (action.type === 'exec') {
                    systemState.stats.execution++;
                }
                if (action.type === 'error' || action.type === 'recursion') {
                    systemState.stats.errors++;
                }
                
                updateStats();
                actionIndex++;
                
                // 5åˆ†çµŒéãƒã‚§ãƒƒã‚¯
                const elapsed = (Date.now() - systemState.startTime) / 1000;
                if (elapsed > 300) {
                    clearInterval(interval);
                    triggerAlert();
                }
            }, 2000 + Math.random() * 2000);
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆç™ºå‹•
        function triggerAlert() {
            systemState.intrusionDetected = true;
            const statusCard = document.getElementById('statusCard');
            statusCard.classList.add('alert');
            statusCard.innerHTML = `
                <div class="status-card-icon">âš ï¸</div>
                <div class="status-card-text">ä¾µå…¥æ¤œçŸ¥ï¼</div>
            `;
            addLog('error', 'ğŸš¨ ç•°å¸¸æ¤œçŸ¥ï¼š5åˆ†ä»¥ä¸Šã®åœæ»ã‚’æ¤œå‡º');
            addLog('error', 'ğŸš¨ äººé–“ã®ä»‹å…¥ãŒå¿…è¦ã§ã™');
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('keyFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('verifyKeyBtn').disabled = false;
                document.getElementById('keyStatus').textContent = 
                    `é¸æŠæ¸ˆã¿: ${file.name} - æ¤œè¨¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„`;
            }
        });

        // ã‚­ãƒ¼æ¤œè¨¼ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('verifyKeyBtn').addEventListener('click', function() {
            const file = document.getElementById('keyFileInput').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
                    const content = e.target.result;
                    let keyData;
                    
                    if (file.name.endsWith('.json')) {
                        keyData = JSON.parse(content);
                    } else {
                        // .pyãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
                        keyData = { content: content };
                    }
                    
                    // æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                    const isValid = keyData.signature === "MAGIC_SEAL_2025" ||
                                   (keyData.content && keyData.content.includes('def unlock'));
                    
                    if (isValid) {
                        systemState.keyVerified = true;
                        document.getElementById('keyStatus').className = 'key-status verified';
                        document.getElementById('keyStatus').textContent = 
                            'âœ… æ¤œè¨¼æˆåŠŸ - ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯';
                        document.getElementById('statusCard').innerHTML = `
                            <div class="status-card-icon">âœ…</div>
                            <div class="status-card-text">ä¿è­·è§£é™¤</div>
                        `;
                        addLog('read', 'âœ… ç‰©ç†ã‚­ãƒ¼æ¤œè¨¼æˆåŠŸ - ã‚·ã‚¹ãƒ†ãƒ è§£é™¤');
                        
                        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’è§£é™¤
                        document.querySelectorAll('.vertex-label').forEach(el => {
                            el.classList.remove('active');
                        });
                    } else {
                        document.getElementById('keyStatus').className = 'key-status failed';
                        document.getElementById('keyStatus').textContent = 
                            'âŒ æ¤œè¨¼å¤±æ•— - ç„¡åŠ¹ãªã‚­ãƒ¼ã§ã™';
                        addLog('error', 'âŒ ç‰©ç†ã‚­ãƒ¼æ¤œè¨¼å¤±æ•—');
                    }
                } catch (error) {
                    document.getElementById('keyStatus').className = 'key-status failed';
                    document.getElementById('keyStatus').textContent = 
                        'âŒ ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãŒä¸æ­£ã§ã™';
                    addLog('error', `âŒ ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«è§£æã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            };
            reader.readAsText(file);
        });

        // æˆ¦è¡“ç”»é¢ã®è¡¨ç¤º/éè¡¨ç¤º
        document.getElementById('toggleTacticalBtn').addEventListener('click', function() {
            const view = document.getElementById('tacticalView');
            view.classList.toggle('visible');
            this.textContent = view.classList.contains('visible') ? 
                'ğŸ“Š æ”»æ’ƒè€…è¦–ç‚¹ã‚’éè¡¨ç¤º' : 'ğŸ“Š æ”»æ’ƒè€…è¦–ç‚¹ã‚’è¡¨ç¤º';
            
            // åˆå›è¡¨ç¤ºæ™‚ã«ä¾µå…¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
            if (view.classList.contains('visible') && !systemState.startTime) {
                systemState.startTime = Date.now();
                simulateIntrusion();
                // çµŒéæ™‚é–“ã®æ›´æ–°
                setInterval(() => {
                    if (!systemState.keyVerified) {
                        updateStats();
                    }
                }, 1000);
            }
        });

        document.getElementById('closeTacticalBtn').addEventListener('click', function() {
            document.getElementById('tacticalView').classList.remove('visible');
            document.getElementById('toggleTacticalBtn').textContent = 'ğŸ“Š æ”»æ’ƒè€…è¦–ç‚¹ã‚’è¡¨ç¤º';
        });

        // åˆæœŸåŒ–
        drawHeptagram();
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿½åŠ ï¼šå¾…æ©Ÿãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ›´æ–°é–¢æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateWaitingModules() {
    const container = document.getElementById('activeModules');
    if (!container) return;  // å®‰å…¨ã‚¬ãƒ¼ãƒ‰

    container.innerHTML = '';  // ã‚¯ãƒªã‚¢

    (systemState.waitingModules || []).forEach(moduleName => {
        const card = document.createElement('div');
        card.className = 'module-card';
        card.textContent = moduleName;
        container.appendChild(card);
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿½åŠ ï¼šãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ£ãƒƒãƒ•ãƒ«é–¢æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shuffleWaitingModules() {
    if (systemState.keyVerified) return;

    const shuffled = [...systemState.allModules].sort(() => Math.random() - 0.5);
    systemState.waitingModules = shuffled.slice(0, 3);  // ãƒ©ãƒ³ãƒ€ãƒ 3å€‹
    updateWaitingModules();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¢å­˜ã® simulateIntrusion() å†…ã«è¿½åŠ ï¼ˆ20è¡Œç›®ã‚ãŸã‚Šï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// é ‚ç‚¹ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã®å¾Œã§ãŸã¾ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆãã‚‹ãã‚‹æ„ŸUPï¼‰
if (action.vertex && Math.random() < 0.2) {
    shuffleWaitingModules();
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆæœŸåŒ–ï¼ˆä¸€ç•ªä¸‹ã«ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', () => {
    shuffleWaitingModules();   // æœ€åˆã«ãƒ©ãƒ³ãƒ€ãƒ 3å€‹è¡¨ç¤º
    drawHeptagram();           // ä¸ƒèŠ’æ˜Ÿæç”»
    console.log("ä¸ƒèŠ’æ˜Ÿé˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†");
    </script>
    
</body>
</html>